<script>
    function bargraph() {
        //Width and height
        var w = 110;
        var h = 50;
        var barPadding = 5;

        $.each($('.bar'), function(index, element) {
            var key = channels[index];

            var dataset = barData[key];
            // console.log(dataset);

            if (dataset) {

                var sum = dataset.reduce((a, b) => a + b, 0);

                var tip = d3.tip()
                    .attr('class', 'd3-tip')
                    .offset([-10, 0])
                    .html(function(d, i) {
                        if (i == 0) {
                            return "<span style='color:red'>" + Math.round((d / sum) * 100) + "%</span>";
                        } else {
                            return "<span style='color:green'>" + Math.round((d / sum) * 100) + "%</span>";
                        }

                    });


                $('.d3-tip').hide();
                $(element).empty();

                var svg = d3.select("#" + $(element).attr("id"))
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

                svg.call(tip);

                var rect = svg.selectAll("rect")
                    .data(dataset)
                    .enter()
                    .append("rect")
                    .attr("height", function(d) {
                        return 50;
                    })
                    .attr("x", function(d, i) {
                        return (i * dataset[0] / sum) * 100 + i * barPadding;
                    })
                    .attr("y", 0)
                    .attr("width", function(d) {
                        return (d / sum) * 100;
                    })
                    .attr("fill", function(d, i) {
                        if (i == 0) {
                            return "red"
                        } else {
                            return "green"
                        }
                    })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide);
            }


        });


    }
</script>